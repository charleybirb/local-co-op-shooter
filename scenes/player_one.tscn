[gd_scene load_steps=18 format=3 uid="uid://d4igm5uqht7m4"]

[ext_resource type="Texture2D" uid="uid://d0u0ch5v815o3" path="res://textures/test_textures/orange/texture_05.png" id="1_5g46b"]
[ext_resource type="Script" uid="uid://d03w6r3sx6gww" path="res://scripts/player.gd" id="1_jjvma"]
[ext_resource type="Script" uid="uid://khrwfnivy0l6" path="res://scripts/weapon.gd" id="3_2pt5b"]
[ext_resource type="Script" uid="uid://c11p5jggd1jax" path="res://scripts/input_manager.gd" id="3_2ye1c"]
[ext_resource type="Script" uid="uid://covxv0ll5wsvm" path="res://scripts/head.gd" id="3_44md6"]
[ext_resource type="Texture2D" uid="uid://c0kdmacw2tqae" path="res://textures/test_textures/red/texture_10.png" id="3_67mun"]
[ext_resource type="PackedScene" uid="uid://bn06c48koa7m5" path="res://scenes/bullet_hole_decal.tscn" id="4_3v6dx"]
[ext_resource type="AudioStream" uid="uid://cf3hx1gvrkm7d" path="res://audio/gunshot.wav" id="6_6sjib"]
[ext_resource type="Script" uid="uid://dp2xmorkro450" path="res://scripts/health_component.gd" id="7_g53jo"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_ahbqi"]
albedo_texture = ExtResource("1_5g46b")

[sub_resource type="CapsuleMesh" id="CapsuleMesh_7gix3"]
material = SubResource("StandardMaterial3D_ahbqi")
radial_segments = 8
rings = 6

[sub_resource type="ConvexPolygonShape3D" id="ConvexPolygonShape3D_qcd3b"]
points = PackedVector3Array(-0.00719303, -0.909086, -0.279793, 0.0225324, 0.468106, 0.490671, -0.0068637, 0.474397, 0.497158, -0.00703843, 0.749853, -0.426867, 0.497179, -0.474237, -0.00681376, -0.35914, -0.587464, 0.316352, -0.475484, 0.585984, -0.0358901, 0.382703, 0.809675, 0.0228572, 0.319528, -0.712519, 0.319611, -0.357693, -0.555818, -0.328471, 0.344187, -0.497093, -0.357497, -0.246424, 0.838152, 0.262366, 0.34644, 0.588779, 0.346526, 0.34725, 0.619772, -0.331368, 0.0226982, -0.591706, -0.480297, 0.0228388, -0.716943, 0.441008, -0.426901, -0.749896, -0.00689052, -0.334047, 0.65426, -0.334029, 0.144924, -0.974687, -0.00711709, -0.128628, 0.971598, -0.0677794, -0.357476, 0.497045, 0.344239, 0.497179, 0.474237, -0.00681376, 0.0229053, 0.870161, 0.32295, -0.158072, -0.936322, 0.174006, -0.0068637, -0.474397, 0.497158, 0.0226983, 0.591712, -0.480302, -0.480305, -0.591828, 0.0226592, 0.380282, -0.804443, -0.0366326, 0.174031, 0.936316, -0.158034, 0.34644, -0.588779, 0.346526, 0.322292, -0.718841, -0.306407, -0.277113, -0.810174, -0.276992)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_2pt5b"]
albedo_texture = ExtResource("3_67mun")

[sub_resource type="BoxMesh" id="BoxMesh_3v6dx"]
material = SubResource("StandardMaterial3D_2pt5b")
size = Vector3(0.15, 0.4, 0.4)

[sub_resource type="Animation" id="Animation_2pt5b"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0.746672, -0.504615, -0.89451)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, -0.00383972, 0)]
}

[sub_resource type="Animation" id="Animation_3v6dx"]
resource_name = "shoot"
length = 0.4
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.0666667, 0.133333, 0.233333),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Vector3(0.746672, -0.504615, -0.89451), Vector3(0.746672, -0.337174, -0.674426), Vector3(0.746672, -0.435665, -0.71187), Vector3(0.746672, -0.504615, -0.89451)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.0666667, 0.133333, 0.233333),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Vector3(0, 0, 0), Vector3(0.503489, -0.00438373, -0.00211509), Vector3(0.55798, -0.00405021, -0.00223946), Vector3(0, 0, 0)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_g53jo"]
_data = {
&"RESET": SubResource("Animation_2pt5b"),
&"shoot": SubResource("Animation_3v6dx")
}

[node name="PlayerOne" type="CharacterBody3D" node_paths=PackedStringArray("input_manager", "head", "mesh", "reticle")]
script = ExtResource("1_jjvma")
input_manager = NodePath("InputManager")
head = NodePath("Head")
mesh = NodePath("MeshInstance3D")
reticle = NodePath("CanvasLayer")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("CapsuleMesh_7gix3")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("ConvexPolygonShape3D_qcd3b")

[node name="Head" type="Node3D" parent="." node_paths=PackedStringArray("tilt", "pan", "camera")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.587935, 0)
script = ExtResource("3_44md6")
tilt = NodePath("Pan/Tilt")
pan = NodePath("Pan")
camera = NodePath("Pan/Tilt/Camera3D")

[node name="Pan" type="Node3D" parent="Head"]

[node name="Tilt" type="Node3D" parent="Head/Pan"]

[node name="Camera3D" type="Camera3D" parent="Head/Pan/Tilt"]

[node name="WeaponSpot" type="Node3D" parent="Head/Pan/Tilt/Camera3D" node_paths=PackedStringArray("raycast", "player")]
script = ExtResource("3_2pt5b")
raycast = NodePath("RayCast3D")
decal_scene = ExtResource("4_3v6dx")
player = NodePath("../../../../..")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Head/Pan/Tilt/Camera3D/WeaponSpot"]
transform = Transform3D(0.999993, 0, -0.00383971, 0, 1, 0, 0.00383971, 0, 0.999993, 0.746672, -0.504615, -0.89451)
mesh = SubResource("BoxMesh_3v6dx")

[node name="AnimationPlayer" type="AnimationPlayer" parent="Head/Pan/Tilt/Camera3D/WeaponSpot/MeshInstance3D"]
libraries = {
&"": SubResource("AnimationLibrary_g53jo")
}

[node name="RayCast3D" type="RayCast3D" parent="Head/Pan/Tilt/Camera3D/WeaponSpot"]
target_position = Vector3(0, 0, -40)

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="Head/Pan/Tilt/Camera3D/WeaponSpot"]
stream = ExtResource("6_6sjib")
volume_db = -7.82

[node name="InputManager" type="Node" parent="."]
script = ExtResource("3_2ye1c")

[node name="CanvasLayer" type="CanvasLayer" parent="."]
visible = false

[node name="Reticle" type="ColorRect" parent="CanvasLayer"]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -0.5
offset_top = -0.5
offset_right = 2.5
offset_bottom = 2.5
grow_horizontal = 2
grow_vertical = 2

[node name="HealthComponent" type="Node" parent="." node_paths=PackedStringArray("mesh")]
script = ExtResource("7_g53jo")
max_health = 50
mesh = NodePath("../MeshInstance3D")
